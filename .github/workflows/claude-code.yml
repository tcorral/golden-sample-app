name: Claude Code Automation
on:
    issues:
      types: [labeled]
jobs:
  run-claude:
    runs-on: ubuntu-latest
    if: contains(github.event.issue.labels.*.name, 'claude-code')
    steps:
      - uses: actions/checkout@v4
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: Install Claude Code
        run: npm install -g @anthropic-ai/claude-code
      - name: Execute Claude Code
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        run: |
          claude config set --global theme dark 
          claude config set hasTrustDialogAccepted true 
          claude config add allowedTools Edit
          claude config add allowedTools Replace
          claude config add allowedTools "Bash(npm install)"
          claude config add allowedTools "Bash(npm test)"
          claude config add allowedTools "Bash(npm run build)"
          claude config add allowedTools "Bash(npm run start:mocks)"
          claude config add ignorePatterns node_modules
          claude config add ignorePatterns "node_modules/**"
          claude -p "Generate a Dockerfile for Node 22"
